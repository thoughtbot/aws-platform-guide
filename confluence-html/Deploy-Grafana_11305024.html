<!DOCTYPE html>
<html>
    <head>
        <title>AWS Platform Guide : Deploy Grafana</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">AWS Platform Guide</a></span>
                            </li>
                                                    <li>
                                <span><a href="AWS-Platform-Guide-Home_13697366.html">AWS Platform Guide Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Provision-Platform-Resources_11304961.html">Provision Platform Resources</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            AWS Platform Guide : Deploy Grafana
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Victoria Guido</span>, last modified by <span class='editor'> Mina Slater</span> on Mar 30, 2023
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div class="panel" style="background-color: #FFFAE6;border-width: 1px;"><div class="panelContent" style="background-color: #FFFAE6;">
<p>This is an advanced topic for platform engineers.</p>
</div></div><p>We use <a class="external-link" href="https://grafana.com/" rel="nofollow">Grafana</a> to monitor infrastructure and applications. You can use AWS's managed services to deploy centralized Prometheus and Grafana instances.</p><p><em>Note for single account deployments: AWS Managed Grafana requires either AWS SSO or a SAML provider to sign in. If you're not using an AWS Organization with SSO enabled, you'll need a SAML provider to continue.</em></p><h2 id="DeployGrafana-AWSManagedPrometheus">AWS Managed Prometheus</h2><p>Flightdeck can forward time series data from its federated Prometheus instance to an AWS Managed Prometheus instance for long-term storage. This instance can also be used as a data source for AWS Managed Grafana.</p><p>Create a root module for your Prometheus workspace:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">infra/
  monitoring/
    prometheus-workspace/
</pre>
</div></div><p>Apply <a class="external-link" href="https://github.com/thoughtbot/flightdeck/tree/main/aws/prometheus-workspace" rel="nofollow">prometheus-workspace module</a> from Flightdeck in the <a href="Account-Conventions_10649900.html" data-linked-resource-id="10649900" data-linked-resource-version="6" data-linked-resource-type="page">Operations account</a>.</p><p>Update your production workload platform configuration to use the Prometheus workspace:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">module &quot;workload_platform&quot; {
  # Match the value from the monitoring/prmetheus-workspace module
  prometheus_workspace_name = &quot;flightdeck&quot;

  # Use the account ID for the Operations account
  monitoring_account_id = &quot;123456789012&quot;
}
</pre>
</div></div><p>Apply the workload platform module to start writing to the Prometheus workspace.</p><h2 id="DeployGrafana-AWSManagedGrafana">AWS Managed Grafana</h2><p>AWS provides managed Grafana instances, but there is currently no support for deploying Grafana using Terraform or Cloudformation, so you need to create the workspace through the AWS Console.</p><h3 id="DeployGrafana-CreatingtheWorkspace">Creating the Workspace</h3><p>In the Operations account:</p><ul><li><p>TODO: TF module for the following configs</p><ul><li><p>Create a workspace named &quot;Flightdeck'.</p></li><li><p>Enable SSO or SAML.</p></li><li><p>Use service-managed permissions.</p></li><li><p>Enable Managed Service for Prometheus and CloudWatch.</p></li><li><p>Enable Amazon SNS.</p></li><li><p>TODO: document about organization access type + OUs</p></li></ul></li><li><p>Manual steps:</p><ul><li><p>Set yourself as an admin of the workspace.</p></li><li><p>Add an SSO group to the workspace.</p></li></ul></li></ul><p>TODO: Order of operation for prometheus workspace, grafana workspace, auth and data sources</p><h3 id="DeployGrafana-SettingupDashboards">Setting up Dashboards</h3><ul><li><p>From the Grafana workspace in the AWS Management Console, sign into the managed Grafana instance.</p></li><li><p>Under Settings, select API Keys.</p></li><li><p>Create a new Admin API key named &quot;Terraform&quot; that expires after 30 days.</p></li><li><p>Copy the API key.</p></li><li><p>TODO: What to do with the copied API key</p></li></ul><p>Once these modules are applied, the platform is fully deployed and you can proceed to build <a class="external-link" href="https://mission-control.thoughtbot.com/branch/main/aws/book/admin/cicd.html" rel="nofollow">CI/CD pipelines</a>.</p>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Mar 18, 2024 10:53</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
