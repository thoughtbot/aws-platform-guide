<!DOCTYPE html>
<html>
    <head>
        <title>AWS Platform Guide : AWS Code Pipeline</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">AWS Platform Guide</a></span>
                            </li>
                                                    <li>
                                <span><a href="AWS-Platform-Guide-Home_13697366.html">AWS Platform Guide Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Deploy_11173953.html">Deploy</a></span>
                            </li>
                                                    <li>
                                <span><a href="11305059.html">Building CI/CD Pipelines</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            AWS Platform Guide : AWS Code Pipeline
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Joe Ferris</span>, last modified on Jul 14, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>Some of our clients deploy applications using <a class="external-link" href="https://docs.aws.amazon.com/codepipeline/latest/userguide/welcome.html" rel="nofollow">CodePipeline</a> and <a class="external-link" href="https://docs.aws.amazon.com/codebuild/latest/userguide/welcome.html" rel="nofollow">CodeBuild</a>.</p><span class="confluence-embedded-file-wrapper image-center-wrapper"><img class="confluence-embedded-image image-center" loading="lazy" src="attachments/14287288/14745728.png" data-image-src="attachments/14287288/14745728.png" data-height="1001" data-width="729" data-unresolved-comment-count="0" data-linked-resource-id="14745728" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="cicd.png" data-base-url="https://thoughtbot.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="14287288" data-linked-resource-container-version="2" data-media-id="a45acd3f-06ab-43fb-828a-4e9c96795687" data-media-type="file"></span><h2 id="AWSCodePipeline-CommonResources">Common Resources</h2><p>In the <a href="Infrastructure-Repository_13599104.html" data-linked-resource-id="13599104" data-linked-resource-version="4" data-linked-resource-type="page">infrastructure repository</a>, create a root module for common CI/CD resources:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">infra/
  cicd-common/</pre>
</div></div><p>In order to deploy CI/CD pipelines on AWS, you will need the following:</p><ul><li><p>An artifact bucket for your organization's build artifacts. You can provision one using the <a class="external-link" href="https://github.com/thoughtbot/terraform-eks-cicd/tree/main/modules/artifact-bucket" rel="nofollow">artifact bucket Terraform module</a>.</p></li><li><p>A CodeBuild credential to trigger builds when pull requests are opened. You can set this up using the <a class="external-link" href="https://github.com/thoughtbot/terraform-eks-cicd/tree/main/modules/codebuild-credential" rel="nofollow">CodeBuild credential Terraform module</a>.</p></li><li><p>A CodeStar connection to trigger pipeline runs when pull requests are merged. You can set this up using the <a class="external-link" href="https://github.com/thoughtbot/terraform-eks-cicd/tree/main/modules/codestar-connection" rel="nofollow">CodeStar connection Terraform module</a>.</p></li></ul><p>These resources should be provisioned in the <a href="Account-Conventions_10649900.html" data-linked-resource-id="10649900" data-linked-resource-version="6" data-linked-resource-type="page">Operations account</a>.</p><p>After adding these modules to your root module, apply the module. Once the module has completed successfully, you will need to sign into the AWS Management Console. Find the pending GitHub connection and follow the instructions in the <a class="external-link" href="https://docs.aws.amazon.com/dtconsole/latest/userguide/connections-update.html" rel="nofollow">AWS Developer Tools Console User Guide</a> to complete the connection.</p><h2 id="AWSCodePipeline-ContinuousIntegration">Continuous Integration</h2><p>For each <a href="Application-Repository_14286884.html" data-linked-resource-id="14286884" data-linked-resource-version="1" data-linked-resource-type="page">application repository</a>, create CodeBuild projects to build Docker images and generate manifests. These projects can be triggered when pull requests are opened using webhooks. Build projects and related resources should be provisioned in the <a href="Account-Conventions_10649900.html" data-linked-resource-id="10649900" data-linked-resource-version="6" data-linked-resource-type="page">Operations account</a>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">infra/
  ci/
    APPLICATION/  </pre>
</div></div><p>In order to build Docker images for an application, you'll need:</p><ul><li><p>A <a class="external-link" href="https://docs.docker.com/engine/reference/builder/" rel="nofollow">Dockerfile</a>. This can be kept in the <a href="Application-Repository_14286884.html" data-linked-resource-id="14286884" data-linked-resource-version="1" data-linked-resource-type="page">application repository</a>.</p></li><li><p>A <a class="external-link" href="https://docs.aws.amazon.com/codebuild/latest/userguide/build-spec-ref.html" rel="nofollow">buildspec</a> for building and pushing Docker images. This can also be kept in the application repository.</p></li><li><p>An <a class="external-link" href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/Repositories.html" rel="nofollow">ECR repository</a>. You can use the <a class="external-link" href="https://github.com/thoughtbot/terraform-eks-cicd/tree/main/modules/ecr-repository" rel="nofollow">ECR repository Terraform module</a> to set this up.</p></li><li><p>A <a class="external-link" href="https://docs.aws.amazon.com/codebuild/latest/userguide/working-with-build-projects.html" rel="nofollow">CodeBuild project</a> for building Docker images. You can create one using the <a class="external-link" href="https://github.com/thoughtbot/terraform-eks-cicd/tree/main/modules/ecr-project" rel="nofollow">ECR project Terraform module</a>.</p></li><li><p>A <a href="Manifest-Repository_14286891.html" data-linked-resource-id="14286891" data-linked-resource-version="1" data-linked-resource-type="page">manifests repository</a> to store configuration and manifests for your application.</p></li><li><p>A buildspec for generating application manifests. This can be stored in the manifests repository and should contain <a class="external-link" href="https://kustomize.io/" rel="nofollow">Kustomize</a> or <a class="external-link" href="https://helm.sh/" rel="nofollow">Helm</a> commands for generating Kubernetes manifests. This buildspec must produce YAML files as artifacts that can later be applied to the cluster to deploy the application.</p></li><li><p>A <a class="external-link" href="https://docs.aws.amazon.com/codebuild/latest/userguide/working-with-build-projects.html" rel="nofollow">CodeBuild project</a> for generating application manifests. You can create one using the <a class="external-link" href="https://github.com/thoughtbot/terraform-eks-cicd/tree/main/modules/manifests-project" rel="nofollow">manifests project Terraform module</a>.</p></li></ul><p>Once this root module is applied, CodeBuild will start building and storing Docker images for your application whenever developers open pull requests.</p><h2 id="AWSCodePipeline-ContinuousDeployment">Continuous Deployment</h2><p>For each stage of the software development lifecycle, create a CodePipeline pipeline to deploy the latest images and manifests to the cluster. This pipeline can be triggered when pull requests are merged using webhooks. Pipelines should be provisioned in the <a href="Account-Conventions_10649900.html" data-linked-resource-id="10649900" data-linked-resource-version="6" data-linked-resource-type="page">Operations account</a>.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">infra/
  cd/
    APPLICATION/</pre>
</div></div><ul><li><p>An IAM role for deploying to each cluster. You can create one using the <a class="external-link" href="https://github.com/thoughtbot/terraform-eks-cicd/tree/main/modules/deploy-role" rel="nofollow">deploy role Terraform module</a>. This role must be provisioned in the same <a href="Account-Conventions_10649900.html" data-linked-resource-id="10649900" data-linked-resource-version="6" data-linked-resource-type="page">Workload account</a> as the cluster.</p></li><li><p>A buildspec for applying manifests to the cluster. You can use kubectl and other commands to apply the manifests generated by your manifests project.</p></li><li><p>A CodeBuild project for applying manifests to the cluster. You can set one up using the <a class="external-link" href="https://github.com/thoughtbot/terraform-eks-cicd/tree/main/modules/deploy-project" rel="nofollow">deploy-project Terraform module</a>.</p></li><li><p>A CodePipeline pipeline for deploying the latest Docker images and manifests to the cluster. You can create pipelines using the <a class="external-link" href="https://github.com/thoughtbot/terraform-eks-cicd/tree/main/modules/cicd-pipeline" rel="nofollow">cicd-pipeline Terraform module</a>.</p></li></ul><p>Once a pipeline is provisioned, the CodeBuild projects for building Docker images and manifests will be triggered whenever a pull request is merged. The artifacts from the manifest project will be provided to the deploy project, which can apply the manifests to the cluster.</p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/14287288/14745728.png">cicd.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Mar 18, 2024 10:54</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
